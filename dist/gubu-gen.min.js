!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).GubuGen=t()}}((function(){var t={exports:{}};(function(e){(function(){!function(i){"object"==typeof t.exports?t.exports=i():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).Carn=i()}((function(){var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Carn=void 0;class e{constructor(t){this.start=-1,this.finish=-1,this.errs=[],this.bail=!0,this.id=t,this.run=-1}error(t,e,...s){let n=new i(this.id,this.run,t,e,...s);if(this.errs.push(n),this.bail)throw n;return n}throw(t,e,...i){throw this.error(t,e,...i)}init(t){this.run=t,this.start=Date.now(),this.bail=!1}check(){return this.active()||this.throw("not_active")}active(){return 0<this.start&&this.finish<0}finished(){return 0<this.finish}}class i extends Error{constructor(t,e,s,n,...r){(r="string"==typeof n?[n,...r]:r&&"string"==typeof r[0]?r:[i.Code[s]||s,...r])[0]+=` [id=${t},run=${e}]`+(n?" {"+Object.keys(n).map(t=>t+":"+n[t])+"}":""),super(...r),this.code=s,this.cid=t,this.crun=e}}i.Code={not_active:"Carn instance is not active (call Carn.start())",already_started:"Carn instance is already started",invalid_depth:"Invalid depth (<0)"},t.Carn=class{constructor(){this.newline="\n",this.indent="  ",this.separator=",",this.dI=0,this.id=1e6*Math.random()|0,this.run=-1,this.s=[],this.ctx=new e(this.id)}start(){return-1==this.ctx.start||this.ctx.finished()?(this.s=[],this.run=1e6*Math.random()|0,this.ctx=new e(this.id),this.ctx.init(this.run)):this.ctx.error("already_started"),this.ctx}add(t){this.ctx.check(),"string"==typeof t&&this.s.push(t)}sep(){this.ctx.check(),this.s.push(new n(this.separator))}depth(t,e){if(this.ctx.check(),"number"==typeof t){let i=(e=null==e||!!e)?this.dI+t:t;i<0&&this.ctx.error("invalid_depth",{move:t,relative:e,depth:i}),this.dI=i,this.s.push(new s(this.dI,this.indent))}return this.dI}finish(){return this.ctx.check(),this.ctx.finish=Date.now(),this.ctx}src(){this.ctx.start<0&&this.ctx.throw("not_active");let t="";for(let e=0;e<this.s.length;e++){let i=e;this.s[i]instanceof s?(t=this.s[i].toString(),this.s[i]=""):(this.s[i+1]instanceof n&&(this.s[i+2]instanceof s||(this.s[i]+=this.s[i+1].toString()),this.s[i+1]="",e++),this.s[i]=t+this.s[i]+this.newline)}return this.s.join("")}inject(t,e,i){let s=this.src();s=s.startsWith("\n")?s:"\n"+s,s=s.endsWith("\n")?s:s+"\n";let n=i[0],r=i[1];const o=new RegExp(n+"START:"+e+r+".*?"+n+"END:"+e+r,"s");return t.replace(o,n+"START:"+e+r+s+n+"END:"+e+r)}};class s{constructor(t,e){this.depth=null==t||t<0?0:t,this.indent=e}toString(){return this.indent.repeat(isNaN(this.depth)?0:this.depth)}}class n{constructor(t){this.separator=t}toString(){return this.separator}}return t}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),t=t.exports;var e={},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MarkerMap=e.GeneratorMap=e.GubuGen=void 0;const s=i({}),n={md:["\x3c!--","--\x3e"]};e.MarkerMap=n;const r={"options~md":function(t,e){var i;e.start(),e.add("## Options");let s=[];if(t(void 0,{err:!1,log:(t,e)=>{if("kv"===t&&"string"==typeof e.key){let t=e.path.slice(1,e.dI+1),i=t.join("."),n=e.node,r=e.key;s.push({path:i,parts:t,node:n,key:r})}}}),0<s.length){s=s.sort((t,e)=>t.path<e.path?-1:t.path>e.path?1:0);let t=1;for(let n of s){let{path:s,parts:r,node:o,key:h}=n,a=o.t,d=o.r,c=o.v,l=(null===(i=o.m)||void 0===i?void 0:i.short)||h,f=r[r.length-1];for(;t<r.length;)e.add(`* _${r[t-1]}_`),e.depth(1),t++;for(;r.length<t;)e.depth(-1),t--;e.add(`* _${f}_: \`${a}\` ${d?"(required)":"(default: "+c+")"} - ${l}`)}}else e.add("_None_")}};return e.GeneratorMap=r,e.GubuGen=class{constructor(){}generate(e){let i=function(t,e){let i=t.generator,s=t.format,n=r[i+"~"+s];if(null===n){let e=`Cannot find generator ${t.generator} for format ${t.format}`;throw new Error(e)}return n}(e);const o=new t.Carn;i(e.shape,o);let h=(a=e.target,s.default.readFileSync(a).toString());var a;let d=o.inject(h,e.generator,n[e.format]);return function(t,e){s.default.writeFileSync(t,e)}(e.target,d),o}},e}));